---
title: "Ticks"
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)
```

```{r, setup}
library(ggiraph)
library(patchwork)
library(tidyverse)
library(neon4cast)
library(score4cast)
library(thematic)
thematic_rmd(bg="white", fg="black", accent="blue")

source("R/plot-utils.R")

```

```{r}
combined <- combined_scores("ticks")

```

## Most recent forecasts

```{r}
min_data <- 10
day <- combined |>
  filter(!is.na(observed)) |>
  count(target_id, variable, model_id, start_time, site_id) |>
  filter(n >= min_data) |> 
  filter(start_time == max(start_time)) |> # must happen second
  select(start_time) |> distinct(start_time) |> first()

```


Below is the latest forecasts for which we have at least `r min_data` observations. Mouse over to see the team id, scroll to zoom.  Note that due to latency of data collection for ticks, 'forecasts' lag considerably behind current dates.



::: {.panel-tabset}


## _Amblyomma americanum_

```{r}
combined |> 
  filter(start_time == day, variable == "amblyomma_americanum") |> 
  forecast_plots()
```

## _Ixodes scapularis_

```{r}
combined |> filter(start_time == day, variable == "ixodes_scapularis") |> forecast_plots()
```


:::






```{r}
filled_scores <- fill_scores(combined, "tickGlobalNull_RandomWalk")
```

## Leaderboard

```{r}

leaderboard <-  filled_scores %>% 
  group_by(variable, model_id) %>%
  summarise(crps = mean(crps),
            logs = mean(logs, na.rm=TRUE)) %>% 
  arrange(crps)
leaderboard %>% DT::datatable(fillContainer = FALSE, escape=FALSE)
```



### _Amblyomma americanum_

```{r}
leaderboard_plots(leaderboard, NULL, "amblyomma_americanum")
```
<!-- Consider adding site-by-site breakout on scores -->


