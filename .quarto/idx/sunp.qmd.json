{"title":"Lake Sunapee Protective Association","markdown":{"yaml":{"title":"Lake Sunapee Protective Association"},"headingText":"Most recent forecasts","containsRefs":false,"markdown":"\n\n```{r, include=FALSE}\nknitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)\n```\n\n```{r setup}\nlibrary(ggiraph)\nlibrary(patchwork)\nlibrary(tidyverse)\nlibrary(neon4cast)\nlibrary(score4cast)\n\nlibrary(remotes)\n\n\nlibrary(thematic)\nthematic_rmd(bg=\"white\", fg=\"black\", accent=\"blue\")\n\nsource(\"R/flare-plots.R\")\nsource(\"R/ignore_sigpipes.R\")\n\n\n```\n\n\nBelow are forecasts for Lake Sunapee, NH. Lake Sunapee is the fifth largest lake in New Hampshire. The forecasts are for the location of the bouy that is maintained by the Lake Sunapee Protective Association.\n\n::: panel-tabset\n## Lake Sunapee\n\n```{r}\ns3_score <- arrow::s3_bucket(bucket = \"scores/parquet\", endpoint_override = \"s3.flare-forecast.org\", anonymous = TRUE)\ns3_forecast <- arrow::s3_bucket(bucket = \"forecasts/parquet\", endpoint_override = \"s3.flare-forecast.org\", anonymous = TRUE)\n  \n## define function arguments\nsite <- 'sunp'\nmodel <- 'test_runS3'\ndepths <- c(0,5,10)\nlake_name <- 'Lake Sunapee'\ny_limits <- c(-5,30)\n\n## do data subsetting\n# find most recent forecast run date for the model and site\nmost_recent <-  arrow::open_dataset(s3_score) |>\n  filter(site_id %in% site,\n         model_id %in% model) |>\n  summarize(max = max(reference_datetime)) |>\n  collect() |>\n  pull()\n\n# subset and collect data based off of site, model, depth, and reference datetime\nscore_df <- arrow::open_dataset(s3_score) |>\n  filter(variable == \"temperature\",\n         depth %in% depths,\n         site_id %in% site,\n         model_id %in% model,\n         reference_datetime == most_recent) |>\n  dplyr::collect()\n```\n\nThe most recent forecast is from `r lubridate::with_tz(lubridate::as_datetime(most_recent), tzone = \"America/New_York\")` (Eastern U.S. time).\n\n```{r sunp-temp}\n\nflareVis::plot_temp_single_panel(data = score_df, depths = depths, ylims = y_limits, site_name = site)\n\n```\n\n```{r sunp-error, eval = FALSE}\ndf_horizon <- arrow::open_dataset(s3, unify_schemas = TRUE) |> \n  filter(variable == \"temperature\",\n         site_id == \"sunp\",\n         depth %in% c(1.0, 10.0),\n         horizon %in% c(2,7,14)) |> \n  dplyr::collect()\n\ndf_horizon |> \n  ggplot(aes(x = observation, y = mean, color = horizon)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") + \n  labs(x = \"observed temperature\", y = \"forecasted temperature\") +\n  theme_bw()\n\n\n```\n\n```{r sunp-depth, eval=F}\n# depth plot\ndepth_scores <- arrow::open_dataset(s3_score) |> \n  filter(variable == \"depth\",\n         site_id %in% c(\"sunp\"),\n         reference_datetime == most_recent) |> \n  dplyr::collect()\n\nplot_depth(depth_scores) \n```\n\n```{r sunp-mixing}\n# chance of being mixed\ntemperature_forecast <- arrow::open_dataset(s3_forecast, unify_schemas = TRUE) |> \n  filter(variable == \"temperature\",\n         site_id %in% c(\"sunp\"),\n         reference_datetime == most_recent,\n         !is.na(prediction)) |> \n  dplyr::collect() \nplot_mixing(forecast_df = temperature_forecast, eval_depths = c(1, 10), use_density = T, threshold = 0.1)\n\n```\n\n```{r sunp-ice}\n# Ice plot\nice_forecasts <- arrow::open_dataset(s3_forecast, unify_schemas = TRUE) |> \n  filter(variable == \"ice_thickness\",\n         site_id %in% c(\"sunp\"),\n         reference_datetime == most_recent) |> \n  dplyr::collect()\n\nplot_ice(ice_forecasts)\n```\n:::\n","srcMarkdownNoYaml":"\n\n```{r, include=FALSE}\nknitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)\n```\n\n```{r setup}\nlibrary(ggiraph)\nlibrary(patchwork)\nlibrary(tidyverse)\nlibrary(neon4cast)\nlibrary(score4cast)\n\nlibrary(remotes)\n\n\nlibrary(thematic)\nthematic_rmd(bg=\"white\", fg=\"black\", accent=\"blue\")\n\nsource(\"R/flare-plots.R\")\nsource(\"R/ignore_sigpipes.R\")\n\n\n```\n\n## Most recent forecasts\n\nBelow are forecasts for Lake Sunapee, NH. Lake Sunapee is the fifth largest lake in New Hampshire. The forecasts are for the location of the bouy that is maintained by the Lake Sunapee Protective Association.\n\n::: panel-tabset\n## Lake Sunapee\n\n```{r}\ns3_score <- arrow::s3_bucket(bucket = \"scores/parquet\", endpoint_override = \"s3.flare-forecast.org\", anonymous = TRUE)\ns3_forecast <- arrow::s3_bucket(bucket = \"forecasts/parquet\", endpoint_override = \"s3.flare-forecast.org\", anonymous = TRUE)\n  \n## define function arguments\nsite <- 'sunp'\nmodel <- 'test_runS3'\ndepths <- c(0,5,10)\nlake_name <- 'Lake Sunapee'\ny_limits <- c(-5,30)\n\n## do data subsetting\n# find most recent forecast run date for the model and site\nmost_recent <-  arrow::open_dataset(s3_score) |>\n  filter(site_id %in% site,\n         model_id %in% model) |>\n  summarize(max = max(reference_datetime)) |>\n  collect() |>\n  pull()\n\n# subset and collect data based off of site, model, depth, and reference datetime\nscore_df <- arrow::open_dataset(s3_score) |>\n  filter(variable == \"temperature\",\n         depth %in% depths,\n         site_id %in% site,\n         model_id %in% model,\n         reference_datetime == most_recent) |>\n  dplyr::collect()\n```\n\nThe most recent forecast is from `r lubridate::with_tz(lubridate::as_datetime(most_recent), tzone = \"America/New_York\")` (Eastern U.S. time).\n\n```{r sunp-temp}\n\nflareVis::plot_temp_single_panel(data = score_df, depths = depths, ylims = y_limits, site_name = site)\n\n```\n\n```{r sunp-error, eval = FALSE}\ndf_horizon <- arrow::open_dataset(s3, unify_schemas = TRUE) |> \n  filter(variable == \"temperature\",\n         site_id == \"sunp\",\n         depth %in% c(1.0, 10.0),\n         horizon %in% c(2,7,14)) |> \n  dplyr::collect()\n\ndf_horizon |> \n  ggplot(aes(x = observation, y = mean, color = horizon)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") + \n  labs(x = \"observed temperature\", y = \"forecasted temperature\") +\n  theme_bw()\n\n\n```\n\n```{r sunp-depth, eval=F}\n# depth plot\ndepth_scores <- arrow::open_dataset(s3_score) |> \n  filter(variable == \"depth\",\n         site_id %in% c(\"sunp\"),\n         reference_datetime == most_recent) |> \n  dplyr::collect()\n\nplot_depth(depth_scores) \n```\n\n```{r sunp-mixing}\n# chance of being mixed\ntemperature_forecast <- arrow::open_dataset(s3_forecast, unify_schemas = TRUE) |> \n  filter(variable == \"temperature\",\n         site_id %in% c(\"sunp\"),\n         reference_datetime == most_recent,\n         !is.na(prediction)) |> \n  dplyr::collect() \nplot_mixing(forecast_df = temperature_forecast, eval_depths = c(1, 10), use_density = T, threshold = 0.1)\n\n```\n\n```{r sunp-ice}\n# Ice plot\nice_forecasts <- arrow::open_dataset(s3_forecast, unify_schemas = TRUE) |> \n  filter(variable == \"ice_thickness\",\n         site_id %in% c(\"sunp\"),\n         reference_datetime == most_recent) |> \n  dplyr::collect()\n\nplot_ice(ice_forecasts)\n```\n:::\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"sunp.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Archive","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.146","editor":"visual","theme":["yeti","custom.scss"],"title-block-style":"default","title-block-banner":"img/carvins_justwater.png","page-layout":"full","title":"Lake Sunapee Protective Association"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}